# 2.【Electron】编写第一个程序



## 创建主脚本文件

主脚本就是 Electron 应用程序主进程的入口，主脚本的名字可以随便起，这里使用的是 `main.js`。
通常，在主进程中运行的脚本，控制应用程序的生命周期、显示图形用户界面及其元素、执行本机操作系统交互以及在网页中创建渲染进程。

> Electron 应用程序只能有一个主进程。



主脚本可以如下所示：

```javascript
/**
 * 从 electron 包导入了 app 和 BrowserWindow 模块。
 * app：管理应用程序的生命周期事件。
 * BrowserWindow：创建和控制浏览器窗口。
 */
const { app, BrowserWindow } = require('electron')

/**
 * 使用 BrowserWindow 创建一个 新的浏览窗口，设置高度和宽度并将 nodeIntegration 设置为 true。
 * 然后将 index.html 文件加载到窗口中。
 * 
 * 也就是说，electron 应用程序中的每一个界面，都是 Chromium 创建出来的窗口。
 */
function createWindow () {
  const win = new BrowserWindow({
    width: 800,
    height: 600,
    webPreferences: {
      nodeIntegration: true
    }
  })

  win.loadFile('index.html')
}

//  当 electron 初始化完成后调用 createWindow 方法创建窗口。
app.whenReady().then(createWindow)

/**
 * 当所有窗口被关闭时，会触发 window-all-closed 事件。
 */
app.on('window-all-closed', () => {
  if (process.platform !== 'darwin') {
    app.quit()
  }
})

/**
 * 当应用被激活时触发。
 * 例如：应用首次运行、重新启动。
 */
app.on('activate', () => {
  if (BrowserWindow.getAllWindows().length === 0) {
    createWindow()
  }
})
```



## 创建网页

这是应用程序初始化后你想要显示的页面。浏览器加载页面的时候，就是渲染过程。

你可以创建多个浏览器窗口，每个窗口都使用自己的独立渲染进程。 每个窗口都可以通过 `nodeIntegration` 选项完全访问 Node.js API。

`index.html` 页面如下所示：

```html
<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Hello World!</title>
    <meta http-equiv="Content-Security-Policy" content="script-src 'self' 'unsafe-inline';" />
</head>
<body style="background: white;">
    <h1>Hello World!</h1>
    <p>
        We are using node <script>document.write(process.versions.node)</script>,
        Chrome <script>document.write(process.versions.chrome)</script>,
        and Electron <script>document.write(process.versions.electron)</script>.
    </p>
</body>
</html>
```



## 修改 package.json 文件

Electron 应用程序使用 `package.json` 文件作为主入口。您的应用程序的主脚本是 `main.js`，所以相应修改 `package.json` 文件：

```json
{
    "name": "my-electron-app",
    "version": "0.1.0",
    "author": "your name",
    "description": "My Electron app",
    "main": "main.js"
}
```
> 注意：如果未设置 `main` 字段，Electron 将尝试加载包含在 `package.json` 文件目录中的 `index.js` 文件。

> 注意：`author` 和 `description` 字段对于打包来说是必要的，否则运行 `npm run make` 命令时会报错。

默认情况下，`npm start` 命令将用 Node.js 来运行主脚本。要使用 Electron 来运行脚本，您需要将其更改为这样：

```json
{
    "name": "my-electron-app",
    "version": "0.1.0",
    "author": "your name",
    "description": "My Electron app",
    "main": "main.js",
    "scripts": {
        "start": "electron ."
    }
}
```



## 参考资料

[创建基本应用程序](https://www.electronjs.org/docs/tutorial/quick-start#%E5%88%9B%E5%BB%BA%E5%9F%BA%E6%9C%AC%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F)

